{% extends 'base.html' %}

{% block content %}
<div class="container my-5 fade-in">

    <div class="row mb-5">
        <div class="col-md-8 mx-auto">
            <form method="POST" action="{% url 'user_dashboard' %}" class="position-relative">
                {% csrf_token %}
                <i class="fas fa-search position-absolute text-muted"
                    style="left: 20px; top: 50%; transform: translateY(-50%); font-size: 1.2rem;"></i>
                <input type="text" name="title"
                    class="form-control form-control-lg bg-dark text-white border-secondary rounded-pill ps-5 py-3"
                    placeholder="Search for another movie, show, or anime..."
                    style="font-size: 1.1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
            </form>
        </div>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-4 border-bottom border-dark pb-3">
        <h2 class="fw-bold mb-0 text-white"
            style="font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; letter-spacing: 1px;">
            Search Results <span class="text-danger">{% if movie_data %}({{ movie_data|length }}){% endif %}</span>
        </h2>
    </div>

    {% if error %}
    <div class="alert alert-danger text-center bg-dark border-danger text-danger py-4 rounded-3 shadow">
        <i class="fas fa-exclamation-circle fa-2x mb-3"></i>
        <p class="mb-0 fs-5">{{ error }}</p>
    </div>
    {% endif %}

    {% if movie_data %}
    <div class="media-grid">
        {% for movie in movie_data %}
        <div class="movie-unit fade-in visible">
            <div class="premium-card shadow-lg">
                <img src="{{ movie.Poster }}" alt="{{ movie.Title }}" loading="lazy"
                    onerror="this.src='https://critics.io/img/movies/poster-placeholder.png'">

                <div class="premium-overlay">
                    <a href="{% url 'detail' movie.imdbID %}" class="premium-btn premium-btn-play">
                        <i class="fas fa-play me-2"></i>Play
                    </a>
                    <a href="{% url 'create_watch_party' movie.imdbID %}" class="premium-btn premium-btn-play"
                        style="background: linear-gradient(45deg, #ff00cc, #333399);">
                        <i class="fas fa-users me-2"></i>Party
                    </a>

                    {% if movie.imdbID in watchlist_ids %}
                    <form method="POST" action="{% url 'remove_from_watchlist' movie.imdbID %}" class="w-100">
                        {% csrf_token %}
                        <button type="submit" class="premium-btn premium-btn-remove">
                            <i class="fas fa-times me-2"></i>Remove
                        </button>
                    </form>
                    {% else %}
                    <form method="POST" action="{% url 'user_dashboard' %}" class="w-100">
                        {% csrf_token %}
                        <input type="hidden" name="imdb_id" value="{{ movie.imdbID }}">
                        <input type="hidden" name="title" value="{{ movie.Title }}">
                        <input type="hidden" name="year" value="{{ movie.Year }}">
                        <input type="hidden" name="poster" value="{{ movie.Poster }}">
                        <button type="submit" name="add_to_watchlist" class="premium-btn premium-btn-list">
                            <i class="fas fa-plus me-2"></i>My List
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>
            <div class="media-info text-center mt-3">
                <div class="media-title text-white fw-bold text-truncate">{{ movie.Title }}</div>
                <div class="media-meta text-muted small">{{ movie.Year }}</div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% else %}
    <div class="text-center py-5">
        <div class="mb-4">
            <i class="fas fa-film fa-4x text-muted opacity-25"></i>
        </div>
        <p class="h3 text-white-50 fw-light">No results found</p>
        <p class="text-secondary">Try searching for something else like "Avengers" or "Breaking Bad"</p>
    </div>
    {% endif %}
</div>
{% endblock %}